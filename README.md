# five_keys_bot

Telegram –±–æ—Ç —Å–æ —Å–ª—É–∂–µ–±–Ω—ã–º–∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   - Python 3.11
   - Redis (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ –æ–±–ª–∞–∫–æ)
   - Git
2. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞.
3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è**: `cp .env.example .env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è.
4. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # –∏–ª–∏ .venv\\Scripts\\activate –≤ Windows
   pip install --upgrade pip
   pip install -r requirements.txt
   ```
5. **–ü–æ–¥–Ω–∏–º–∏—Ç–µ Redis** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ):
   ```bash
   redis-server
   ```
6. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**:
   ```bash
   make migrate  # –∏–ª–∏: alembic upgrade head
   ```
7. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**:
   ```bash
   python run.py
   ```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –ø–æ–¥–Ω–∏–º–µ—Ç HTTP-—Å–µ—Ä–≤–∏—Å —Å health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ –∏ –Ω–∞—á–Ω—ë—Ç polling/–æ–±—Ä–∞–±–æ—Ç–∫—É –≤–µ–±—Ö—É–∫–∞ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

- **Health**: `curl http://127.0.0.1:8080/ping` ‚Äî –æ–∂–∏–¥–∞–µ—Ç—Å—è `{"status":"ok"}`.
- **–î–æ–∫—Ç–æ—Ä**: `python tools/doctor.py` ‚Äî –≤—ã–≤–æ–¥–∏—Ç JSON —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Redis –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
- **–ü–∞–Ω–µ–ª—å**: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/panel` –≤ Telegram –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏–∑ `ADMIN_IDS`) –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏:
  - üîÅ Ping ‚Äî –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç `/ping`.
  - ü™™ Echo ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π `/doctor/echo`.
  - üìú –õ–æ–≥–∏ ‚Äî –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ö–≤–æ—Å—Ç —Ñ–∞–π–ª–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (—Å–µ–∫—Ä–µ—Ç—ã –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è).
- **–í–µ—Ä—Å–∏—è**: –∫–æ–º–∞–Ω–¥–∞ `/version` (—Ç–∞–∫–∂–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) –≤–µ—Ä–Ω—ë—Ç —Ç–µ–∫—É—â–∏–π —Ö—ç—à —Å–±–æ—Ä–∫–∏ –∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (NORMAL/FALLBACK).

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∞–≤—Ç–æ—Å–∏–Ω–∫

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `scripts/sync.sh` (–∏–ª–∏ `scripts/sync.ps1` –Ω–∞ Windows). –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä–∫–µ—Ä–∞ `.ciok`, stash'—è—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ CI.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ò–º—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `BOT_TOKEN` | Telegram —Ç–æ–∫–µ–Ω –±–æ—Ç–∞. |
| `ADMIN_IDS` | –°–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é). |
| `WEB_HOST` / `WEB_PORT` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è health/–≤–µ–±—Ö—É–∫–∞. |
| `TRIBUTE_WEBHOOK_PATH` | –ü—É—Ç—å –≤–µ–±—Ö—É–∫–∞ Tribute. |
| `REDIS_URL` | URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis. |
| `OPENAI_API_KEY` | –ö–ª—é—á –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenAI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). |
| `LOG_PATH` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (—Ä–æ—Ç–∞—Ü–∏—è 5√ó5 –ú–ë). |
| `DEBUG` | –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (`1` ‚Äî –≤–∫–ª—é—á–µ–Ω–æ). |
| `CALLBACK_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ callback-–∫–Ω–æ–ø–æ–∫. |
| `BUILD_SHA` | (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ö—ç—à —Å–±–æ—Ä–∫–∏, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω `git`. |
| `ALLOW_STASH` | –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `git stash` –≤ sync-—Å–∫—Ä–∏–ø—Ç–∞—Ö. |

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ [.env.example](.env.example).

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `make migrate` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic (—Å–æ–∑–¥–∞—ë—Ç SQLite –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
- `alembic upgrade head` ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π.
- `python -m compileall run.py app` ‚Äî –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. **Secret Scanning** ‚Äî –≤–∫–ª—é—á–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —á—Ç–æ–±—ã GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–∞–ª —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤.
2. **Dependabot** ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Security &gt; Code security &gt; Dependabot). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—á–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `app/` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞, —Ö—ç–Ω–¥–ª–µ—Ä—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è.
- `scripts/` ‚Äî —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.
- `tools/doctor.py` ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.
- `alembic/` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- `version.py` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–≤–∏–∑–∏–æ–Ω–Ω–æ–≥–æ —Ö—ç—à–∞.

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º –∑–∞–ø—É—Å–∫–∞:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ `tools/doctor.py` ‚Äî –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è —Ç–∞–º.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –¥–æ—Å—Ç—É–ø–µ–Ω –∏ `REDIS_URL` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (`tail -f logs/telemetry.log`).
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—á–∏—Å—Ç–∏—Ç–µ lock-—Ñ–∞–π–ª `.run/bot.lock` –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º.
