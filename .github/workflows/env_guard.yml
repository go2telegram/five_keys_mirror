name: env_guard
on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  check-env-example:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Ensure .env.example keeps required keys
        run: |
          REQ_KEYS=(
            BOT_TOKEN DEV_DRY_RUN HEALTH_PORT
            DB_URL MIGRATE_ON_START TIMEZONE
            LOG_LEVEL LOG_DIR
            IMAGES_BASE QUIZ_IMG_BASE
            USE_REDIS REDIS_URL
            CODEX_SHARED_KEY
          )
          missing=0
          for k in "${REQ_KEYS[@]}"; do
            if ! grep -q "^${k}=" .env.example; then
              echo "::error title=Missing key::${k} not found in .env.example"
              missing=1
            fi
          done
          if [ $missing -ne 0 ]; then
            echo "Some required keys are missing"; exit 1
          fi
