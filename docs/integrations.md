# Внешние интеграции

Модуль `integrations` объединяет коннекторы для обмена данными с внешними
сервисами CRM. Сейчас поддерживаются Google Sheets, Notion и произвольный
вебхук (webhook sink).

## Настройка окружения

Добавьте в `.env` необходимые переменные:

```env
ENABLE_EXTERNAL_INTEGRATIONS=true
GDRIVE_CREDENTIALS={...json сервисного аккаунта...}
NOTION_TOKEN=secret_...
WEBHOOK_SINK_URL=https://example.com/hook
```

* `ENABLE_EXTERNAL_INTEGRATIONS` — главный переключатель. Если переменная не
  задана или содержит `false`, бот будет отвечать, что интеграции выключены.
* `GDRIVE_CREDENTIALS` — JSON сервисного аккаунта Google (строка или путь до
  файла). Используется для экспорта таблиц в Google Sheets.
* `NOTION_TOKEN` — токен интеграции Notion. Чтобы экспортировать лиды в базу,
  укажите её `database_id` в команде.
* `WEBHOOK_SINK_URL` — URL для приёма JSON-пакета с данными. Его можно
  переопределить прямо в команде `/export`.

## Команды администратора

После включения интеграций администратор может использовать несколько команд:

* `/integrations` — показывает доступные коннекторы и подсказки.
* `/export leads` — экспорт лидов. По умолчанию используется Google Sheets.
* `/export leads google <название>` — экспорт в Google Sheets c пользовательским
  заголовком таблицы.
* `/export leads notion <database_id>` — экспорт в указанную базу Notion.
* `/export leads webhook [url]` — отправка JSON-пакета на вебхук.

Каждый коннектор возвращает статус операции. Ошибки логируются, бот присылает
понятное сообщение и продолжает работу.

## Импорт данных

Базовые методы импорта определены в абстракции коннекторов. Их можно расширять,
если потребуется подтягивать данные извне (например, из Notion) и далее
обрабатывать их внутри бота.

## Откат изменений

Чтобы временно отключить интеграции, установите
`ENABLE_EXTERNAL_INTEGRATIONS=false` и перезапустите бота. Для полного отката
удалите пакет `integrations` и связанные команды из бота.
