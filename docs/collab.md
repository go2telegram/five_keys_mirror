# Интерфейс совместной работы оператора и ИИ

## Обзор

Раздел `/collab` предоставляет оператору рабочее место для ручной проверки и редактирования решений, предложенных моделью. Интерфейс построен на Streamlit и позволяет:

- просматривать текущие задачи, авто-решения и предложенные рекомендации;
- редактировать текст рекомендаций перед отправкой клиенту;
- фиксировать решение: «Принять», «Изменить» или «Отклонить».

Все действия логируются в `collab/collab_history.jsonl`, что даёт возможность восстановить историю изменений.

## Быстрый старт

1. Убедитесь, что зависимость Streamlit установлена (`pip install -r requirements.txt`).
2. Запустите веб-интерфейс:
   ```bash
   streamlit run collab/app.py --server.baseUrlPath=collab
   ```
3. Откройте страницу [http://localhost:8501/collab](http://localhost:8501/collab) (порт зависит от запуска Streamlit).
4. Введите имя оператора в боковой панели и выберите нужную задачу.
5. Отредактируйте рекомендацию при необходимости и нажмите одну из кнопок действий.

## Формат данных

- `collab/tasks.json` — список задач, доступных оператору. Файл можно заполнять автоматически ботом или вручную.
- `collab/collab_history.jsonl` — журнал действий. Каждая строка содержит JSON с полями `timestamp`, `action`, `task_id`, `status`, `operator`, `notes`, `previous` и `current`.

## Интеграция с ботом

Модуль `bot/admin_collab.py` предоставляет сервисные функции для работы с задачами:

- `load_tasks()` — загрузка текущего списка задач;
- `update_task_decision()` — запись решения оператора и логирование в историю;
- `add_task()` — добавление новой задачи в очередь.

Используйте флаг окружения `ENABLE_HUMAN_COLLAB=true`, чтобы включить функциональность на боевом окружении. При значении `false` интерфейс и взаимодействия можно отключить, сохранив возможность отката.

## Откат

Для выключения режима совместной работы установите `ENABLE_HUMAN_COLLAB=false` и удалите каталог `collab/`, если нужно полностью убрать UI и связанные данные.
