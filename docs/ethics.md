# Этический контроль автоматических действий

## Обзор
Модуль `ethics` добавляет проверку действий бота на соответствие простым правилам.
Перед выполнением автоматических операций вызывается `EthicsValidator`, который
сверяет название действия с YAML-файлом `ethics/rules.yml`.

Если действие не описано в `allowed_actions` либо явно указано в
`forbidden_actions`, выполнение блокируется и событие считается нарушением.
Количество нарушений отображается в `/ethics_status`.

## Структура
- `ethics/rules.yml` — перечень разрешённых и запрещённых действий.
- `ethics/validator.py` — интерпретатор правил.
- `app/ethics.py` — точка подключения валидатора к приложению.

## Использование
1. **Проверка действий.**
   Все автоматические рассылки и изменение opt-in проходят через
   `ethics_validator.ensure_allowed(action, details=...)`.
2. **Статистика.**
   Команда `/ethics_status` (для администратора) показывает включён ли модуль и
   сколько нарушений зафиксировано.
3. **Отключение.**
   Установите переменную окружения `ENABLE_ETHICS=false`, чтобы временно
   отключить проверки.

## Добавление правил
Редактируйте `ethics/rules.yml`. Любое новое автоматическое действие должно быть
явно перечислено в `allowed_actions`. Изменения вступают в силу без перезапуска
бота — достаточно сохранить файл и, при необходимости, вызвать
`ethics_validator.reload()` из кода.

## Проверка
1. Добавьте тестовое запрещённое действие в `forbidden_actions` и запустите
   автоматическую рассылку — бот откажется выполнять действие.
2. Откройте `/ethics_status`, чтобы увидеть рост счётчика нарушений.
