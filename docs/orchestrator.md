# Meta orchestrator

Мета-оркестратор отвечает за распределение задач между ботами/агентами и даёт
единый контрольный интерфейс.

## Конфигурация

* `ENABLE_META_ORCHESTRATOR` — включает маршруты и телеграм-команды. При `false`
  оркестратор не используется, а HTTP-эндпоинт `/orchestrator_status`
  возвращает `503`.

## Регистрация агентов

Агент должен вызвать `register_agent` (или `heartbeat`) у
`orchestrator.manager.orchestrator_manager`, передав:

* `agent_id` — уникальный идентификатор.
* `capacity` — максимальное количество параллельных задач.
* `priority` — вес при распределении (чем выше, тем раньше получает задачи).

Агент может отправлять периодические heartbeat'ы, чтобы обновить статус или
включить/выключить себя.

## Распределение задач

1. Задача передаётся в `submit_task` вместе с приоритетом.
2. Оркестратор выбирает свободного агента с минимальной загрузкой (учитывается
   текущий `assigned/capacity`) и более высоким приоритетом.
3. Если свободных агентов нет, задача попадает в очередь ожидания.
4. После завершения агент сообщает `complete_task`, и задача помечается
   выполненной.

Метрики:

* `tasks_distributed_total` — сколько раз задачи были переданы агентам.
* `avg_task_latency` — среднее время от постановки в очередь до завершения
  задачи.

## Мониторинг

* HTTP: `GET /orchestrator_status` — JSON с агентами, очередью и метриками.
* Телеграм: `/orchestrator` (только для `ADMIN_ID`) — форматированный отчёт.

## Rollback

Установите `ENABLE_META_ORCHESTRATOR=false` и перезапустите приложение. Тогда
оркестратор не будет активен и новые задачи распределяться не будут.
