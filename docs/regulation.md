# Regulation layer

Слой саморегуляции следит за экономикой токенов внутри бота. Каждую неделю
(по умолчанию — понедельник 04:00 локального времени) запускается задача
`jobs.economy_regulate.run_weekly_regulation`, которая оценивает KPI сети и
подбирает мягкие коэффициенты налога (`tax_rate`) и субсидии (`subsidy_rate`).

## KPI

Расчёт использует значения из `app.storage.ECONOMY_KPI`. Для симуляций и тестов
можно менять показатели через `app.storage.update_economy_kpi`.

| KPI | Описание |
| --- | --- |
| `circulating_tokens` | Фактическое количество токенов в обороте |
| `target_tokens` | Целевая «здоровая» масса токенов |
| `velocity` | Относительная скорость оборота (1.0 = норма) |
| `stability_index` | Индекс стабильности экономики (0…1) |
| `utilization` | Доля вовлечённых участников (0…1) |
| `engagement_index` | Индекс вовлечённости (0…1.2) |

## Метрика `economic_balance`

Баланс рассчитывается как 1 минус штраф за отклонения (разрыв в предложении,
нестабильность, низкую утилизацию). Значение стремится к 1 при стабильной
экономике и падает к 0 при сильных перекосах.

## Команда `/regulation_status`

Команда доступна в боте и показывает текущие коэффициенты. Если слой выключен
через `ENABLE_REGULATION_LAYER=false`, команда сообщит об этом.

## Откат

Чтобы отключить регулирование, установите `ENABLE_REGULATION_LAYER=false` и
перезапустите сервис. Задача обновления не будет запускаться, а `/regulation_status`
покажет, что слой отключён.
