# Прогноз и планирование

Модуль прогнозирования строит краткосрочные прогнозы (Holt-Winters) для ключевых метрик:

- `rps` — запросы в секунду;
- `revenue_total` — суммарная выручка;
- `error_rate` — доля ошибок.

## Источник данных

Исторические значения берутся из `analytics/data/metrics.csv` (формат: `date,rps,revenue_total,error_rate`).
Обновляйте файл новой статистикой по мере поступления данных.

## Конфигурация

В `.env` доступны параметры:

- `ENABLE_PREDICTIVE_PLANNER` — включает все связанные функции (по умолчанию `true`).
- `FORECAST_METRICS` — перечень метрик через запятую для ежедневного отчёта (по умолчанию `rps,revenue_total,error_rate`).
- `FORECAST_DAYS` — горизонт прогноза в днях для команд и джобы (по умолчанию `7`).
- `FORECAST_HOUR_LOCAL` / `FORECAST_MINUTE_LOCAL` — локальное время запуска ежедневного отчёта.

## Команды

`/forecast <metric>` — отправляет график и рекомендации по метрике. Доступно только администратору.
`/forecast_help` — список поддерживаемых метрик.

## Ежедневная рассылка

APScheduler запускает джобу `send_daily_forecasts`, которая строит прогнозы для всех настроенных метрик
и отправляет результат в админский чат.

## Метрики точности

Скрипт `python analytics/forecast.py --metric=<name> --days=7` выполняет backtest и выводит MAE.
Цель — удерживать MAE < 10%.

## Отключение

Для быстрого отката установите `ENABLE_PREDICTIVE_PLANNER=false` и перезапустите бота. Джоба и команды будут отключены.
