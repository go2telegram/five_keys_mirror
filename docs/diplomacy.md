# Интерсетевая дипломатия Five Keys

Механизм позволяет обмениваться знаниями, торговыми потоками и алертами между кластерами Five Keys без полного слияния сетей.

## Настройка

1. Убедитесь, что второй кластер доступен в договоре `diplomacy/contracts.yml`.
2. Активируйте флаг `ENABLE_INTER_NETWORK_DIPLOMACY=true` в переменных окружения или `.env`.
3. Установите зависимости (`pip install -r requirements.txt`).

## Контракты

Файл `diplomacy/contracts.yml` описывает участвующие сети и доступные стратегии:

- `knowledge_exchange` — синхронизация исследовательских наработок.
- `trade_agreement` — согласование экономических потоков.
- `alert_sharing` — совместные предупреждения по рискам.

Стратегии можно расширять, добавив новые блоки и реализовав обработчик в `diplomacy/handshake.py`.

## Рукопожатие

Ключевой модуль `diplomacy/handshake.py` формирует отчёт об обменах. Для успешного рукопожатия должны завершиться минимум две стратегии: обмен знаниями и торговое соглашение. Алерты — дополнительный канал.

```python
from diplomacy.handshake import DiplomacyHandshake

handshake = DiplomacyHandshake()
report = handshake.perform_handshake()
print(report.to_dict())
```

## Административная команда

После активации флага в Telegram-боте доступна команда `/diplomacy_status` (только для администратора). Она показывает актуальные обмены, баланс и новые данные, полученные от партнёра.

## Мониторинг и откат

- /version, /ping и /metrics продолжают работать без изменений.
- Для отключения дипломатии выставьте `ENABLE_INTER_NETWORK_DIPLOMACY=false` и перезапустите бота.
- Для полного отката удалите каталог `diplomacy/` и связанные зависимости.
